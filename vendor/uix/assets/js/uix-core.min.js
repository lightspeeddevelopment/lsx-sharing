var conduitApp={},coduitTemplates={},conduitRegisterApps,conduitModal,conduitModalSave,conduitGenID,conduitSaveObject,conduitGetData;!jQuery(function(a){var b=null;conduitException=function(a){this.message=a,this.name="ConduitException"},a.fn.conduitTrigger=function(b){var c={method:"GET",url:ajaxurl};return a.extend(!0,c,b),a.ajax(c).success(function(){}),this},a.fn.getObject=function(){for(var b=a(this),c=b.find("[name]"),d={},e={},f=0;f<c.length;f++){var g=a(c[f]),h=g.prop("name").replace(/\]/gi,"").split("["),i=g.val(),j={};if(!g.is(":radio")&&!g.is(":checkbox")||g.is(":checked")){if(g.prop("required")&&!g.val().length)throw g.focus(),new conduitException("requiredfield");for(var k=h.length-1;k>=0;k--){var l=h[k];if("undefined"==typeof l&&(l=""),0===l.length&&(j=[],"undefined"==typeof e[h[k-1]]?e[h[k-1]]=0:e[h[k-1]]+=1,l=e[h[k-1]]),k===h.length-1){if(i)if("true"===i)i=!0;else if("false"===i)i=!1;else if(isNaN(parseFloat(i))||parseFloat(i).toString()!==i){if("string"==typeof i&&("{"===i.substr(0,1)||"["===i.substr(0,1)))try{i=JSON.parse(i)}catch(m){}}else i=parseFloat(i);j[l]=i}else{var n=j;j={},j[l]=n}}a.extend(!0,d,j)}}return d},conduitGeneralBaldrick=function(){a(".wp-trigger").conduitTrigger({method:"POST",before:function(b){var c=a(b),d=c.closest("[data-app]");d.length?c.data("data",JSON.stringify(conduitBuildData(d.data("app")))):c.data("data")&&c.data("data",JSON.stringify(conduitBuildData(c.data("data"))))}})},conduitSaveObject=function(c){var d;d=!0===c?conduitPrepObject():conduitPrepObject(c);var e={action:uix.slug+"_save_config",uix_setup:a("#uix_setup").val(),page_slug:uix.page_slug,config:JSON.stringify(d),autosave:!0};uix.save_params&&(e.params=uix.save_params),a(window).trigger("uix.saving"),b&&b.abort(),b=a.post(ajaxurl,e,function(c){a(window).trigger("uix.saved"),b=null})},conduitPrepObject=function(){var a={};for(var b in conduitApp)conduitApp[b].app&&(conduitApp[b].app.is(":visible")?a[b]=conduitBuildData(b):a[b]=conduitApp[b].data);return a},conduitModalFooter=function(b){var c,d=b.buttons?b.buttons.split(" "):["save"],e=b.modal.split("."),f=b.app?b.app:b.trigger.closest("[data-app]").data("app"),g={__node_path:e.join(".")},h="";g.__app=f,b.trigger.data("callback")&&(g.__callback=b.trigger.data("callback"));for(var i=0;i<d.length;i++)h+=a("#__partial_"+d[i]).length?a("#__partial_"+d[i]).html():"";return(c=Handlebars.compile(h,{data:!0}))(g)},conduitModal=function(a,b){var c=a.modal.split("."),d=a.app?a.app:a.trigger.closest("[data-app]").data("app"),e=a["default"]?a["default"]:null,f=Handlebars.compile('<div data-app="'+a.template+'">{{> '+a.template+"}}</div>",{data:!0});if(data={},conduitBuildData(d),conduitApp[d]){var g=conduitApp[d].data;if(null!==e)data=e;else{for(var h=0;h<c.length;h++)g=g[c[h]]?g[c[h]]:{};data=g}}return data.__node_path=a.points,data.__app=d,conduitApp[a.template]={app:b.content,data:data},coduitTemplates[a.template]=f,f(data)},conduitGetData=function(a){var b=a.trigger.data("app"),c={};return conduitApp[b]&&conduitApp[b].data?conduitApp[b].data:c},conduitBuildData=function(a){if(conduitApp[a]&&conduitApp[a].app)try{conduitApp[a].data=conduitApp[a].app.getObject()}catch(b){return!1}return conduitApp[a].data},conduitSyncData=function(a){conduitBuildData(a),conduitBuildUI(a)},conduitRegisterApps=function(){var b=a("[data-app]").not("._bound_app");if(b.length&&(b.each(function(){var b=a(this),c=b.data("app");conduitApp[c]={app:b,data:uix.config[c]?uix.config[c]:{}},b.addClass("_bound_app")}),uix.tabs))for(var c in uix.tabs)if(uix.tabs[c]["default"]){a('[data-tab="'+c+'"]').trigger("click");break}},conduitBuildUI=function(b){if(conduitApp[b]){var c=conduitApp[b].data;c._tab={};for(var d in conduitApp)d!==b&&(c._tab[d]=conduitApp[d].data);conduitApp[b].app.html(coduitTemplates[b](c))}a(window).trigger("uix.init"),a(window).trigger("modal.init")},conduitSetNode=function(b,c,d){for(var e=b.split("."),f='{ "'+e.join('": { "')+'" : '+JSON.stringify(d),g=0;g<e.length;g++)f+="}";var h=JSON.parse(f);a.extend(!0,conduitApp[c].data,h),conduitBuildUI(c)},conduitGenID=function(){var a=(new Date).getTime(),b="ndxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b},conduitAddNode=function(b,c,d){var e=conduitGenID(),f=b.data?b.data("addNode").split("."):b.split("."),g=d?d:b.data("nodeDefault"),h=f.join(".")+"."+e,i=JSON.parse('{ "_id" : "'+e+'", "_node_point" : "'+h+'" }');g&&"object"==typeof g&&a.extend(!0,i,g);for(var j='{ "'+f.join('": { "')+'" : { "'+e+'" : '+JSON.stringify(i),k=0;k<=f.length;k++)j+="}";var l=JSON.parse(j);conduitBuildData(c),a.extend(!0,conduitApp[c].data,l),conduitBuildUI(c)},a(document).on("click",".cf-reports-card-actions .confirm a",function(b){b.preventDefault();var c=a(this).closest(".cf-reports-card-content");actions=c.find(".row-actions"),actions.slideToggle(300)}),a(document).on("keyup change",'[data-format="slug"]',function(b){var c=a(this);return c.data("master")&&c.prop("required")&&this.value.length<=0&&"change"===b.type?(this.value=a(c.data("master")).val().replace(/[^a-z0-9]/gi,"_").toLowerCase(),void(this.value.length&&c.trigger("change"))):void(this.value=this.value.replace(/[^a-z0-9]/gi,"_").toLowerCase())}),a(document).on("keyup change","[data-sync]",function(){var b=a(this),c=a(b.data("sync"));c.each(function(){var c=a(this);c.is("input")?c.val(b.val()).trigger("change"):c.text(b.val())})}),a(document).on("click","[data-add-node]",function(b){var c=a(this),d=c.closest("[data-app]").data("app");d&&"object"==typeof conduitApp[d]&&(b.preventDefault(),conduitAddNode(c,d))}),a(document).on("click","[data-remove-element]",function(b){var c=a(this),d=c.closest("[data-app]").data("app"),e=a(c.data("removeElement"));(!c.data("confirm")||confirm(c.data("confirm")))&&(e.remove(),conduitSyncData(d))}),a(document).on("click","[data-save-object]",function(b){b.preventDefault();var c,d=a(this),e=a(this).data("saveObject"),f=a(".page-title-action .spinner"),g=a(".uix-sub-nav");a(".uix-notice .notice-dismiss").trigger("click"),c=!0===e?conduitPrepObject():conduitPrepObject(e),d.addClass("saving"),f.slideDown(100);var h={action:uix.slug+"_save_config",uix_setup:a("#uix_setup").val(),page_slug:uix.page_slug,config:JSON.stringify(c)};uix.save_params&&(h.params=uix.save_params),a.post(ajaxurl,h,function(b){f.slideUp(100),d.removeClass("saving");var c=a(coduitTemplates.__notice(b));c.hide().insertAfter(g).slideDown(200),a(window).trigger("uix.saved")})}),a(document).on("change","[data-live-sync]",function(b){var c=a(this).closest("[data-app]").data("app");conduitSyncData(c)}),a(document).on("click","button[data-live-sync]",function(b){var c=a(this).closest("[data-app]").data("app");conduitSyncData(c)}),a(document).on("click",".uix-notice .notice-dismiss",function(){var b=a(this).closest(".uix-notice");b.slideUp(200,function(){b.remove()})}),a(document).on("click","[data-tab]",function(b){b.preventDefault();var c=a(this),d=c.data("tab"),e=a(".active[data-tab]").data("tab");if(e){if(conduitBuildData(e),e===d)return;a('[data-app="'+e+'"]').empty().hide()}a("[data-tab]").removeClass("active"),a('[data-app="'+d+'"]').show(),c.addClass("active"),conduitBuildUI(d)}),a("script[data-template]").each(function(){var b=a(this),c=b.data("template");coduitTemplates[c]=Handlebars.compile(b.html(),{data:!0})}),a("script[data-handlebars-partial]").each(function(){var b=a(this);Handlebars.registerPartial(b.data("handlebarsPartial"),b.html())}),a(document).on("click","[data-modal-node]",function(b){var c,d=a(this),e=d.data("modal-node").split("."),f=d.data("app")?d.data("app"):e.shift(),g=d.data("type")?d.data("type"):"save";if("delete"!==g)try{c=d.closest(".uix-modal-wrap").getObject()}catch(b){return}if("add"===g)conduitAddNode(e.join("."),f,c);else if("delete"===g){var h=e.shift();e.length&&(h+="["+e.join("][")+"]"),a('[name^="'+h+'"]').remove(),conduitBuildData(f),conduitBuildUI(f)}else conduitSetNode(e.join("."),f,c);a(window).trigger("close.modal"),d.data("callback")&&("function"==typeof d.data("callback")?d.data("callback")(c,d):"function"==typeof window[d.data("callback")]&&window[d.data("callback")](c,d))}),a(window).on("close.modal",function(b){var c=a(".active[data-tab]").data("tab");c&&conduitBuildUI(c)}),conduitRegisterApps(),window.onbeforeunload=function(){return b?!1:void 0}});